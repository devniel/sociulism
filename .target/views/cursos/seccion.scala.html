@(curso : Curso, seccion:Seccion)

@import helper.twitterBootstrap._
@import helper._

@****************************************
  SCRIPTS
  ***********************************@

@scripts = {

// SECCION 

$('#navbar').affix();

/*
 *  Al cliquear sobre cualquier área fuera de las sugerencias, estas se eliminan.
 */ 

$("body").click(function(e) {
 if(e.target.className !== 'suggestions' || e.target.className !== 'suggestion'){
    $(".suggestions").remove();
  }
});

/*
 *  Al seleccionar una sugerencia de profesor
 */

$("#seccion-profesor").on("click"," .suggestions .suggestion",function(e){

  var nombre = $(e.target).text();
  // SUGERENCIAS DE PROFESORES
  var id = $($(e.target).parent()).find(".profesor_id").text();
  // Asignar nombre a input
  $("input[name='seccion.profesor']").val(nombre);
  $("input[name='seccion.profesor_id']").val(id);

});



$(".input-prepend-alumnos").on("click",".input-prepend .suggestions .suggestion",function(e){

  var nombre = $(e.target).text();
  // SUGERENCIAS DE ESTUDIANTES
  var id = $($(e.target).parent()).find(".alumno_id").text();
  // Asignar nombre a input
  $("input[name='seccion.alumno']").val(nombre);
  $("input[name='seccion.alumno_id']").val(id);

});



/*
 * Sugerencias de profesores del curso a ser receptores
 */

$("#seccion-profesor").on("keyup", "input[name='seccion.profesor']" , function(e){

  $(".suggestions").remove();

  $.ajax({
      type: "GET",
      url: "/usuarios/profesores",
      contentType : "application/json;charset=utf-8",
      dataType : "json",
    }).done(function( msg ) {

      console.log("PROFESORES : " ,msg);

      var lista = msg;

      var value = $(e.target).val();
      var m = new RegExp(value,"g");
      var sugerencias = "";

      for(var i in lista){
        if(lista[i].nombres.match(m) != null){

          var exists= false;

          for(var j=0;j<$(".receptores ul li").length;j++){
            if(lista[i].id == $($(".receptores ul li")[j]).find(".receptor_id").text()){
              exists = true;
              break;
            }
          }

          if(!exists)
            sugerencias += '<li><span class="profesor suggestion_metadata profesor_id">' + lista[i].id + '</span><a class="suggestion">' + lista[i].nombres + ' ' + lista[i].apellidos + '</a></li>';
        }      
      }

      if(sugerencias != ""){
        var lista_sugerencias = $("<ul class='nav nav-list span6 suggestions'>" + sugerencias + "</ul>");
        lista_sugerencias.insertAfter($(e.target));
      }
  });

});



/*
 * Sugerencias de alumnos del curso a ser agregados
 */

$("input[name='seccion.alumno']").keyup(function(e){

  $(".suggestions").remove();

  $.ajax({
      type: "GET",
      url: "/usuarios/alumnos",
      contentType : "application/json;charset=utf-8",
      dataType : "json",
    }).done(function( msg ) {

      console.log("ESTUDIANTES : " ,msg);

      var lista = msg;

      var value = $(e.target).val();
      var m = new RegExp(value,"g");
      var sugerencias = "";

      for(var i in lista){
        if(lista[i].apellidos.match(m) != null){

          var exists= false;

          for(var j=0;j<$(".receptores ul li").length;j++){
            if(lista[i].id == $($(".receptores ul li")[j]).find(".receptor_id").text()){
              exists = true;
              break;
            }
          }

          if(!exists)
            sugerencias += '<li><span class="alumno suggestion_metadata alumno_id">' + lista[i].id + '</span><a class="suggestion">' + lista[i].nombres + ' ' + lista[i].apellidos + '</a></li>';
        }      
      }

      if(sugerencias != ""){
        var lista_sugerencias = $("<ul class='nav nav-list span6 suggestions'>" + sugerencias + "</ul>");
        lista_sugerencias.insertAfter($(e.target));
      }
  });

});


/*
 * Al hacer clic en modificar, se muestra el formulario del Profesor
 */


  $("#showFormProfesor").click(function(){
    $("#seccion-profesor").html('<form class="form-horizontal" method="POST" action="/admin/cursos/@curso.getId()/seccion/@seccion.getId()/update/profesor/"><fieldset><div class="control-group"><label class="control-label" for="input01">Profesor :</label><div class="controls"><div class="input-prepend"><span class="add-on"><i class="icon-user"></i></span><input name="seccion.profesor" class="span6 with-icon" id="inputIcon" type="text" placeholder="Asignar profesor" autocomplete="off"></div></div></div><input type="hidden" name="seccion.profesor_id"/><div class="control-group"><div class="controls"><button class="btn  btn-primary" type="submit">Asignar</button</div></div></fieldset></form>');
  });





}

@****************************************
  NAVBAR
  ***************************************@

@navbar = {
  <li><a href="/"><i class="icon-home"></i> Inicio</a></li>
  <!--<li><a href="/admin/facultades">Facultades</a></li>-->
  <li><a href="/admin/usuarios"><i class="icon-user"></i> Usuarios</a></li>
  <li  class="active"><a href="/admin/cursos"><i class="icon-book"></i> Cursos</a></li>
}

@****************************************
  SIDEBAR
  ***********************************@

@sidebar = {
  <ul class="nav nav-list bs-docs-sidenav affix" data-spy="affix" data-offset-top="200" id="navTab">
    <li class="nav-header">ACCIONES</li>
    <li><a href="/admin/cursos"><i class="icon-th-list"></i>Listar cursos</a></li>
    <li><a href="/admin/cursos/create"><i class="icon-plus"></i>Crear curso</a></li>

    <li class="nav-header">@curso.getNombre()</li>
    <li><a href="/admin/cursos"><i class="icon-info-sign"></i>Editar información</a></li>
    <li>
      <a href="/admin/cursos/@curso.getId/secciones"><i class="icon-th-large"></i>Secciones</a>
      <ul class="nav nav-list">
        @for(seccion_curso <- curso.getSecciones()){

          @if(seccion_curso.getId() == seccion.getId()){
            <li class="active"><a href="/admin/cursos/@curso.getId/seccion/@seccion_curso.getId()"><i class="icon-chevron-right"></i>@seccion_curso.getSeccion()</a></li>
          }else{
            <li><a href="/admin/cursos/@curso.getId/seccion/@seccion_curso.getId()"><i class="icon-chevron-right"></i>@seccion_curso.getSeccion()</a></li>
          }
          
        }
      </ul>
    </li>

  </ul>
}

@****************************************
  MAINBAR
  ***********************************@

@mainbar = {

<style type="text/css">
  .sugerencias ul{
    list-style:none;
    padding:0 !important;
  }

  .controls {
    position:relative !important;
  }

  .input-prepend{
    position: relative !important;
    font-size: inherit !important;
  }

  .suggestions {
    padding-left: 0px !important;
    padding-right: 0px !important;
    border:1px solid #CCC;
    background: #FFF;
    width:458px !important;
    position:absolute;
    top:28px;
    left:0;
    z-index: 10000 !important;
  }

  .suggestions > li > a{
    margin-right: 0px !important;
    margin-left: 0px !important;
    cursor:pointer;
    display:block;
  }

  .suggestion_metadata {
    display:none;
  }

  .receptor_id {
    display:none;
  }

  .receptores {
    margin-left:0px !important;
    margin-top:5px !important;
  }

  .receptores ul{
    padding:0px !important;
    margin-left:0px !important;
    list-style:none !important;
  }

  .receptores ul li i {
    margin-right:5px;
  }

  input.with-icon {
    width :422px !important;
  }

  .question:hover {
    background: #CCC;
    cursor:pointer;
  }

  .question .row {
    line-height : 62px;
  }
</style>

    <div class="page-header">
      <h1>Sección @seccion.getSeccion()</h1>
    </div>
  

      @************************
        SECCIONES
        **********************@

          <!--<div class="alert alert-error">
            Este curso no tiene secciones. Los usuarios son asignados solo a secciones por curso, por lo que es necesario contar al menos con una sección.
          </div>-->

          

              @if(seccion.getProfesor() == null){

                <div id="seccion-profesor">
                  <form class="form-horizontal" method="POST" action="/admin/cursos/@curso.getId()/seccion/@seccion.getId()/add/profesor/">
                      <fieldset>
    
                        <div class="control-group">
                          <label class="control-label" for="input01">Profesor :</label>
                          <div class="controls">
                            <div class="input-prepend">
                              <span class="add-on"><i class="icon-user"></i></span><input name="seccion.profesor" class="span6 with-icon" id="inputIcon" type="text" placeholder="Asignar profesor" autocomplete="off">
                            </div>
                          </div>
                        </div>

                        <input type="hidden" name="seccion.profesor_id"/>
                          
                          <div class="control-group">
                            <div class="controls">
                              <button class="btn  btn-primary" type="submit">Asignar</button>
                            </div>
                          </div>
                    </fieldset>
                  </form>
                </div>

              }else{

                <div id="seccion-profesor">
                  <div class="span6">
                    <span class="span6"><strong><i class="icon-user"></i> Profesor : </strong> @seccion.getProfesor().getNombres()
                      <button type="button" class="pull-right btn btn-mini" id="showFormProfesor">Modificar</button>
                    </span>
                  </div>
                </div>

              }

              <br/>
              <br/>

              <div class="page-header">
                <h3>Alumnos</h3>
              </div>


              <form class="form-horizontal" method="POST" action="/admin/cursos/@curso.getId()/seccion/@seccion.getId()/add/alumno/">
                    <fieldset>
                      <div class="control-group">
                        <label class="control-label" for="input01">Agregar alumno :</label>
                        <div class="controls">
                          <div class="input-prepend input-prepend-alumnos">
                            <span class="add-on"><i class="icon-user"></i></span><input name="seccion.alumno" class="span6 with-icon" id="inputIcon" type="text" placeholder="Buscar por nombre ..." autocomplete="off">
                          </div>
                        </div>
                      </div>

                      <input type="hidden" name="seccion.alumno_id"/>
                        
                        <div class="control-group">
                          <div class="controls">
                            <button class="btn  btn-primary" type="submit">Agregar</button>
                          </div>
                        </div>


                  </fieldset>
                </form>



              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Nombres</th>
                    <th>Apellidos</th>
                    <th>Usuario</th>
                  </tr>
                </thead>
                <tbody>
            
                @for(alumno <- seccion.getUsuarios()){
                  @if(alumno.getUsuario() != null){
                    @if(alumno.getUsuario().getRol() == 0){
                      <tr>
                        <td>@alumno.getUsuario().getId()</td>
                        <td>@alumno.getUsuario().getNombres()</td>
                        <td>@alumno.getUsuario().getApellidos()</td>
                        <td>@alumno.getUsuario().getUsername()</td>
                      </tr>
                    }
                  }
                }

                </tbody>
              </table>


              

             <!--<div class="span6 sugerencias destinatarios">
                <ul>
                  <li>Rocio Checa</li>
                  <li>Daniel Flores</li>
                </ul>
              </div>

              <ul class="nav nav-list span6 suggestions">
                <li class="nav-header">
                  &nbsp;Profesores
                </li>
                <li>
                  <a class="suggestion" href="#">LOLWUT</a>
                </li>
                <li>
                  <a class="suggestion" href="#">Nadia Rodriguez</a>
                </li>
                <li>
                  <a class="suggestion" href="#">Rocío del Pilar Checa Fernandez</a>
                </li>
                <li>
                  <a class="suggestion" href="#">Nadia Rodriguez</a>
                </li>
                <li>
                  <a class="suggestion" href="#">Rocío del Pilar Checa Fernandez</a>
                </li>
                <li>
                  <a class="suggestion" href="#">Nadia Rodriguez</a>
                </li>
                <li>
                  <a class="suggestion" href="#">Rocío del Pilar Checa Fernandez</a>
                </li>
                <li>
                  <a class="suggestion" href="#">Nadia Rodriguez</a>
                </li>
              </ul>-->




            
}



@admin_layout(null,scripts,navbar,sidebar,mainbar)