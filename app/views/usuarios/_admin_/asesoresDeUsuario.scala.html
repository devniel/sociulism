@(usuario : Usuario)

@import helper.twitterBootstrap._
@import helper._

@scripts = {

/*
  $('#navbar').affix()

  $(function () {
      $('#navTab a:first').tab('show');
  })

  $('#navTab a').click(function (e) {
    e.preventDefault();
    $(this).tab('show');
  })
*/



  /*
   *  Al cliquear sobre cualquier área fuera de las sugerencias, estas se eliminan.
   */ 

  $("body").click(function(e) {
   if(e.target.className !== 'suggestions' || e.target.className !== 'suggestion'){
      $(".suggestions").remove();
    }
  });

  /*
   *  Al seleccionar una sugerencia
   */

  $(".input-prepend").on("click",".suggestions .suggestion",function(e){

    var nombre = $(e.target).text();
    var id = $($(e.target).parent()).find(".receptor_id").text();

    $("<li><i class='icon-user'></i><span class='receptor_id'>" + id + "</span>" +  nombre + "</li>").appendTo($(".asesores ul"));

    $("input[name='usuario.asesor']").val(id);
    $("input[name='buscador_asesor']").val("");
    $(".input-prepend").remove();

  });

  /*
   * Sugerencias de profesores del curso a ser asesores
   */

  $("input[name='buscador_asesor']").keyup(function(e){

    $(".suggestions").remove();

    $.ajax({
        type: "GET",
        url: "/usuarios/profesores",
        contentType : "application/json;charset=utf-8",
        dataType : "json",
      }).done(function( msg ) {

        console.log("PROFESORES : " ,msg);

        var lista = msg;

        var value = $(e.target).val();
        var m = new RegExp(value,"g");
        var sugerencias = "";

        for(var i in lista){
          if(lista[i].nombres.match(m) != null){

            var exists= false;

            for(var j=0;j<$(".asesores ul li").length;j++){
              if(lista[i].id == $($(".asesores ul li")[j]).find(".receptor_id").text()){
                exists = true;
                break;
              }
            }

            if(!exists)
              sugerencias += '<li><span class="suggestion_metadata receptor_id">' + lista[i].id + '</span><a class="suggestion">' + lista[i].nombres + ' ' + lista[i].apellidos + '</a></li>';
          }      
        }

        if(sugerencias != ""){
          var lista_sugerencias = $("<ul class='nav nav-list span6 suggestions'>" + sugerencias + "</ul>");
          lista_sugerencias.insertAfter($(e.target));
        }
    });

  });
  
} 

@main(null, scripts){

  <style>

    .navbar .nav li.dropdown.open > .dropdown-toggle, .navbar .nav li.dropdown.active > .dropdown-toggle, .navbar .nav li.dropdown.open.active > .dropdown-toggle {
      color: #FFF !important;
    }

    .navbar .nav > li > a {
      text-shadow: none !important;
    }

    .navbar .nav li.dropdown.open > .dropdown-toggle .caret, .navbar .nav li.dropdown.active > .dropdown-toggle .caret, .navbar .nav li.dropdown.open.active > .dropdown-toggle .caret {
      border-top-color : #FFF !important;
      border-bottom-color: #FFF !important;
    }

  </style>

  <li><a href="/">Inicio</a></li>
  <!--<li><a href="/admin/facultades">Facultades</a></li>-->
  <li class="active"><a href="/admin/usuarios">Usuarios</a></li>
  <li><a href="/admin/cursos">Cursos</a></li>
  
}{

  <style type="text/css">
  </style>

        @*********************
         * CONTENIDO *
         *********************@

      <!-- Example row of columns -->
      <div class="row">

        <div class="span12">
          <div class="row titilium">

            <!--
              SIDEBAR
            -->
            <div class="span3 pull-left">
              <ul class="nav nav-list bs-docs-sidenav affix" data-spy="affix" data-offset-top="200" id="navTab">
                <li class="nav-header">ACCIONES</li>
                <li><a href="/admin/usuarios"><i class="icon-th-list"></i>Listar usuarios</a></li>
                <li><a href="/admin/usuarios/create"><i class="icon-plus"></i>Crear usuario</a></li>
                <li class="nav-header">@usuario.getNombres()</li>
                <li><a href="/admin/usuarios/@usuario.getId()/edit"><i class="icon-info-sign"></i>Editar datos</a></li>
                <li class="active"><a href="/admin/usuarios/@usuario.getId()/asesores"><i class="icon-book"></i>Asesores de usuario</a></li>
              </ul>         
            </div>
            <!-- / SIDEBAR -->

            <style type="text/css">
              .sugerencias ul{
                list-style:none;
                padding:0 !important;
              }

              .controls {
                position:relative !important;
              }

              .input-prepend{
                position: relative !important;
                font-size: inherit !important;
              }

              .suggestions {
                padding-left: 0px !important;
                padding-right: 0px !important;
                border:1px solid #CCC;
                background: #FFF;
                width:458px !important;
                position:absolute;
                top:28px;
                left:0;
                z-index: 10000 !important;
              }

              .suggestions > li > a{
                margin-right: 0px !important;
                margin-left: 0px !important;
                cursor:pointer;
                display:block;
              }

              .suggestion_metadata {
                display:none;
              }

              .receptor_id {
                display:none;
              }

              .asesores {
                margin-left:0px !important;
                margin-top:5px !important;
              }

              .asesores ul{
                padding:0px !important;
                margin-left:0px !important;
                list-style:none !important;
              }

              .asesores ul li i {
                margin-right:5px;
              }

              input.with-icon {
                width :422px !important;
              }

              .question:hover {
                background: #CCC;
                cursor:pointer;
              }

              .question .row {
                line-height : 62px;
              }


            </style>

            <div class="span9 pull-right">

                <div class="page-header">
                  <h1>Asesores de usuario</h1>
                </div>


                  @*********************
                  * FORMULARIO *
                  *********************@

              @if(usuario.getAsesores().get(0).getAsesor == null){
                <div class="alert alert-block">
                  <h4>!Atención!</h4>
                  El estudiante no tiene asesores asignados.
                </div>
              }else{
                  <ul>
                    @for(usuarioAsesor <- usuario.getAsesores()){
                        <li>@usuarioAsesor.getAsesor().getNombres()</li>
                    }
                  </ul>
              }

              <form class="form-horizontal" method="POST" action="/usuario/@usuario.getId()/asesores/new" id="form-asesor_usuario">
                  <fieldset>

                    <div class="control-group">
                      <label class="control-label" for="input01">Asesor : </label>
                      <div class="controls">

                        @**********************************
                          asesores
                          Por defecto es el profesor del curso donde está matriculado el estudiante
                        *********************************@

                        <div class="span6 asesores">
                          <ul>
                          </ul>
                        </div>

                        <div class="input-prepend">
                          <span class="add-on"><i class="icon-plus"></i></span><input placeholder="Buscar asesor ..." name="buscador_asesor" class="span6 with-icon" id="inputIcon" type="text">
                        </div>

                        <input type="hidden" name="usuario.asesor"/>

                      </div>
                    </div>

                    <div class="control-group">
                      <div class="controls">
                        <button class="btn  btn-primary" type="submit">Asignar asesor</button>
                      </div>
                    </div>

                  </fieldset>
                </form>

            </div>
          </div>
        </div>

     </div>

}